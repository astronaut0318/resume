主要功能：
- 文件上传下载
- 简历导出
- 文件管理

实现思路：
1. 实现文件上传和预览
2. 支持简历导出为PDF/Word
3. 实现文件列表管理
4. 添加文件类型限制和大小控制

# 文件服务功能实现报告

## 1. 技术架构

### 1.1 核心技术栈
- **前端框架**：Vue 3 + Vite
- **状态管理**：Pinia
- **UI组件库**：Element Plus
- **HTTP客户端**：Axios
- **模拟数据**：Mock.js + vite-plugin-mock

### 1.2 项目结构
```
src/
├── api/
│   └── file.js          # 文件服务API接口
├── components/
│   ├── FileUploader.vue # 文件上传组件
│   └── ResumeExporter.vue # 简历导出组件
├── mock/
│   └── file.js          # 文件服务模拟数据
├── stores/
│   └── file.js          # 文件状态管理
└── views/
    └── FileManager.vue  # 文件管理页面
```

## 2. API接口实现

### 2.1 文件上传
```javascript
export function uploadFile(file, type = '') {
  const formData = new FormData()
  formData.append('file', file)
  
  if (type) {
    formData.append('type', type)
  }
  
  return axios.post('/api/files/upload', formData, {
    headers: {
      'Content-Type': 'multipart/form-data'
    }
  })
}
```

### 2.2 文件下载
```javascript
export function downloadFile(fileId, fileName) {
  // 开发环境模拟实现
  if (import.meta.env.MODE === 'development') {
    return new Promise((resolve) => {
      // 创建模拟下载
      const blob = new Blob(['模拟文件内容'], { type: 'application/octet-stream' })
      const url = window.URL.createObjectURL(blob)
      const link = document.createElement('a')
      link.href = url
      link.download = fileName
      document.body.appendChild(link)
      link.click()
      document.body.removeChild(link)
      window.URL.revokeObjectURL(url)
      
      resolve({
        data: {
          code: 200,
          message: '下载成功'
        }
      })
    })
  }
  
  // 生产环境实现
  return axios.get(`/api/files/${fileId}/download`, {
    responseType: 'blob'
  })
}
```

### 2.3 简历导出
```javascript
export function exportResumeToPdf(resumeId) {
  return axios.get(`/api/files/resume/${resumeId}/pdf`, {
    responseType: 'blob'
  })
}

export function exportResumeToWord(resumeId) {
  return axios.get(`/api/files/resume/${resumeId}/word`, {
    responseType: 'blob'
  })
}
```

### 2.4 文件管理
```javascript
export function getFileList(params = {}) {
  return axios.get('/api/files', { params })
}

export function deleteFile(fileId) {
  return axios.delete(`/api/files/${fileId}`)
}
```

## 3. 状态管理实现

使用Pinia创建文件状态管理，包含以下核心功能：

### 3.1 状态定义
```javascript
const fileList = ref([])
const loading = ref(false)
const total = ref(0)
const currentPage = ref(1)
const pageSize = ref(10)
const fileType = ref('')
```

### 3.2 错误处理与容错机制
- 针对网络错误实现自动重试
- 开发环境下使用模拟数据兜底
- 细化错误类型并提供友好提示

```javascript
if (error.code === 'ECONNABORTED') {
  ElMessage.warning('下载请求超时，文件可能过大或网络不稳定')
} else if (error.code === 'ERR_NETWORK') {
  ElMessage.warning('网络连接问题，请检查您的网络')
} else if (error.response && error.response.status === 500) {
  ElMessage.warning('服务器处理请求时出错，请稍后再试')
}
```

## 4. 网络优化

### 4.1 Axios配置优化
```javascript
// 配置axios
axios.defaults.timeout = 30000 // 增加超时时间到30秒
axios.defaults.retry = 2 // 增加重试次数到2次
axios.defaults.retryDelay = 1500 // 增加重试延时到1.5秒
axios.defaults.maxContentLength = 10485760 // 设置最大响应内容长度为10MB
```

### 4.2 请求拦截与响应处理
- 为文件下载请求设置更长的超时时间
- 实现请求失败后的自动重试机制
- 针对Blob类型响应的特殊处理

### 4.3 Vite代理配置优化
```javascript
proxy: {
  '/api': {
    target: 'http://127.0.0.1:5173',
    changeOrigin: true,
    rewrite: (path) => path,
    configure: (proxy, options) => {
      proxy.timeout = 30000
      proxy.agent = null
      proxy.maxSockets = 100
      proxy.keepAlive = true
    }
  }
}
```

## 5. 开发环境适配

### 5.1 Mock数据实现
使用vite-plugin-mock提供模拟数据，避免因后端服务不可用而影响前端开发。

```javascript
// 获取文件列表
export const getFileListMock = (req, res) => {
  // 解析查询参数
  const query = req.query || {}
  const page = parseInt(query.page) || 1
  const size = parseInt(query.size) || 10
  const type = query.type

  // 生成随机文件列表
  const list = []
  for (let i = 0; i < size; i++) {
    // 生成模拟文件数据...
  }

  return {
    code: 200,
    message: '获取成功',
    data: {
      total: 35,
      list
    }
  }
}
```

### 5.2 网络异常处理
当API请求失败时，自动降级使用本地模拟数据：

```javascript
// 检查是否是网络错误或服务器错误
if (error.code === 'ECONNABORTED' || error.code === 'ERR_NETWORK' || 
    (error.response && error.response.status >= 500)) {
  // 在开发环境中使用模拟数据
  if (import.meta.env.MODE === 'development') {
    // 创建模拟数据...
    return { success: true, data: { list: mockList, total: 35 } }
  }
}
```

## 6. 性能优化

### 6.1 资源管理
- 及时释放Blob URL资源：`window.URL.revokeObjectURL(url)`
- 优化大文件下载体验，提供进度反馈

### 6.2 网络优化
- 增加请求超时和重试机制
- 针对下载操作增加专用的错误处理
- 解决ENOBUFS网络缓冲区不足问题

## 7. 未来计划

### 7.1 待优化点
- 实现分片上传以支持超大文件
- 添加断点续传功能
- 增强文件预览能力，支持更多文件类型
- 实现文件上传进度显示

### 7.2 安全性增强
- 添加文件类型校验
- 实现文件内容安全扫描
- 敏感信息过滤
- 访问权限控制主要功能：
- 文件上传下载
- 简历导出
- 文件管理

实现思路：
1. 实现文件上传和预览
2. 支持简历导出为PDF/Word
3. 实现文件列表管理
4. 添加文件类型限制和大小控制